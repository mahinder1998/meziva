{"version":3,"file":"ui.js","sourceRoot":"","sources":["../../../src/private/node/ui.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAC,MAAM,EAAC,MAAM,aAAa,CAAA;AAElC,OAAO,EAAC,UAAU,EAAC,MAAM,oCAAoC,CAAA;AAC7D,OAAO,EAAC,QAAQ,EAAC,MAAM,gCAAgC,CAAA;AAEvD,OAAO,EAAM,MAAM,IAAI,SAAS,EAAgB,MAAM,KAAK,CAAA;AAC3D,OAAO,EAAC,YAAY,EAAC,MAAM,QAAQ,CAAA;AAQnC,MAAM,UAAU,UAAU,CAAC,OAAoB,EAAE,EAAC,QAAQ,GAAG,MAAM,EAAE,aAAa,EAAoB;IACpG,MAAM,EAAC,MAAM,EAAE,cAAc,EAAE,OAAO,EAAC,GAAG,YAAY,CAAC,OAAO,EAAE,aAAa,CAAC,CAAA;IAE9E,IAAI,cAAc,EAAE,CAAC;QACnB,MAAM,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAA;IAClC,CAAC;IAED,OAAO,EAAE,CAAA;IAET,OAAO,cAAc,CAAA;AACvB,CAAC;AAED,MAAM,CAAC,KAAK,UAAU,MAAM,CAAC,OAAoB,EAAE,OAAuB;IACxE,MAAM,EAAC,aAAa,EAAC,GAAG,SAAS,CAAC,OAAO,EAAE,OAAO,CAAC,CAAA;IACnD,MAAM,aAAa,EAAE,CAAA;IACrB,4FAA4F;IAC5F,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC,CAAA;AACxD,CAAC;AAOD,MAAM,OAAO,MAAO,SAAQ,YAAY;IAMtC,YAAY,OAA0C;QACpD,KAAK,EAAE,CAAA;QAJA,WAAM,GAAa,EAAE,CAAA;QAS9B,UAAK,GAAG,CAAC,KAAa,EAAE,EAAE;YACxB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;YACvB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAA;QACzB,CAAC,CAAA;QAED,cAAS,GAAG,GAAG,EAAE;YACf,OAAO,IAAI,CAAC,UAAU,CAAA;QACxB,CAAC,CAAA;QAXC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,IAAI,EAAE,CAAA;QACpC,IAAI,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,IAAI,EAAE,CAAA;IAChC,CAAC;CAUF;AAED,MAAM,YAAY,GAAG,CAAC,OAAqB,EAAE,aAA6B,EAAY,EAAE;IACtF,MAAM,OAAO,GAAG,UAAU,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAA;IAC1D,8DAA8D;IAC9D,MAAM,MAAM,GAAI,aAAa,EAAE,MAAc,IAAI,IAAI,MAAM,CAAC,EAAC,OAAO,EAAC,CAAC,CAAA;IAEtE,MAAM,QAAQ,GAAG,SAAS,CAAC,OAAO,EAAE;QAClC,MAAM;QACN,KAAK,EAAE,IAAI;QACX,WAAW,EAAE,KAAK;QAClB,YAAY,EAAE,KAAK;KACpB,CAAC,CAAA;IAEF,OAAO;QACL,MAAM,EAAE,MAAM,CAAC,SAAS,EAAE;QAC1B,OAAO,EAAE,QAAQ,CAAC,OAAO;KAC1B,CAAA;AACH,CAAC,CAAA;AAED,MAAM,UAAU,WAAW,CACzB,KAAa,EACb,GAAQ,EACR,IAAI,GAAG,GAAG,EAAE;IACV,QAAQ,CAAC,OAAO,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAA;AACjC,CAAC;IAED,IAAI,KAAK,KAAK,GAAG,IAAI,GAAG,CAAC,IAAI,EAAE,CAAC;QAC9B,gEAAgE;QAChE,IAAI,EAAE,CAAA;IACR,CAAC;AACH,CAAC","sourcesContent":["import {output} from './output.js'\nimport {Logger, LogLevel} from '../../public/node/output.js'\nimport {isUnitTest} from '../../public/node/context/local.js'\nimport {treeKill} from '../../public/node/tree-kill.js'\nimport {ReactElement} from 'react'\nimport {Key, render as inkRender, RenderOptions} from 'ink'\nimport {EventEmitter} from 'events'\n\ninterface RenderOnceOptions {\n  logLevel?: LogLevel\n  logger?: Logger\n  renderOptions?: RenderOptions\n}\n\nexport function renderOnce(element: JSX.Element, {logLevel = 'info', renderOptions}: RenderOnceOptions) {\n  const {output: renderedString, unmount} = renderString(element, renderOptions)\n\n  if (renderedString) {\n    output(renderedString, logLevel)\n  }\n\n  unmount()\n\n  return renderedString\n}\n\nexport async function render(element: JSX.Element, options?: RenderOptions) {\n  const {waitUntilExit} = inkRender(element, options)\n  await waitUntilExit()\n  // We need to wait for other pending tasks -- unmounting of the ink component -- to complete\n  return new Promise((resolve) => setImmediate(resolve))\n}\n\ninterface Instance {\n  output: string | undefined\n  unmount: () => void\n}\n\nexport class Stdout extends EventEmitter {\n  columns: number\n  rows: number\n  readonly frames: string[] = []\n  private _lastFrame?: string\n\n  constructor(options: {columns?: number; rows?: number}) {\n    super()\n    this.columns = options.columns ?? 80\n    this.rows = options.rows ?? 80\n  }\n\n  write = (frame: string) => {\n    this.frames.push(frame)\n    this._lastFrame = frame\n  }\n\n  lastFrame = () => {\n    return this._lastFrame\n  }\n}\n\nconst renderString = (element: ReactElement, renderOptions?: RenderOptions): Instance => {\n  const columns = isUnitTest() ? 80 : process.stdout.columns\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const stdout = (renderOptions?.stdout as any) ?? new Stdout({columns})\n\n  const instance = inkRender(element, {\n    stdout,\n    debug: true,\n    exitOnCtrlC: false,\n    patchConsole: false,\n  })\n\n  return {\n    output: stdout.lastFrame(),\n    unmount: instance.unmount,\n  }\n}\n\nexport function handleCtrlC(\n  input: string,\n  key: Key,\n  exit = () => {\n    treeKill(process.pid, 'SIGINT')\n  },\n) {\n  if (input === 'c' && key.ctrl) {\n    // Exceptions thrown in hooks aren't caught by our errorHandler.\n    exit()\n  }\n}\n"]}