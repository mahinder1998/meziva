{"version":3,"file":"TextAnimation.js","sourceRoot":"","sources":["../../../../../src/private/node/ui/components/TextAnimation.tsx"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable id-length */\nimport {Text, useStdout} from 'ink'\nimport React, {memo, useCallback, useLayoutEffect, useRef, useState} from 'react'\nimport gradient from 'gradient-string'\n\ninterface TextAnimationProps {\n  text: string\n  maxWidth?: number\n}\n\nfunction rainbow(text: string, frame: number) {\n  const hue = 5 * frame\n  const leftColor = {h: hue % 360, s: 0.8, v: 1}\n  const rightColor = {h: (hue + 1) % 360, s: 0.8, v: 1}\n  return gradient(leftColor, rightColor)(text, {interpolation: 'hsv', hsvSpin: 'long'})\n}\n\nfunction rotated(text: string, steps: number) {\n  const normalizedSteps = steps % text.length\n  const start = text.slice(-normalizedSteps)\n  const end = text.slice(0, -normalizedSteps)\n  return start + end\n}\n\nfunction truncated(text: string, maxWidth: number | undefined): string {\n  return maxWidth ? text.slice(0, maxWidth) : text\n}\n\n/**\n * `TextAnimation` applies a rainbow animation to text.\n */\nconst TextAnimation = memo(({text, maxWidth}: TextAnimationProps): JSX.Element => {\n  const frame = useRef(0)\n  const [renderedFrame, setRenderedFrame] = useState(text)\n  const timeout = useRef<NodeJS.Timeout>()\n  const {stdout} = useStdout()\n  const [width, setWidth] = useState(maxWidth ?? Math.floor(stdout.columns * 0.66))\n\n  useLayoutEffect(() => {\n    const handleResize = () => {\n      setWidth(Math.floor(stdout.columns * 0.66))\n    }\n\n    stdout.on('resize', handleResize)\n\n    return () => {\n      stdout.off('resize', handleResize)\n    }\n  }, [stdout])\n\n  const renderAnimation = useCallback(() => {\n    const newFrame = frame.current + 1\n    frame.current = newFrame\n\n    setRenderedFrame(rainbow(truncated(rotated(text, frame.current), width), frame.current))\n\n    timeout.current = setTimeout(() => {\n      renderAnimation()\n    }, 35)\n  }, [text, width])\n\n  useLayoutEffect(() => {\n    renderAnimation()\n\n    return () => {\n      clearTimeout(timeout.current)\n    }\n  }, [renderAnimation])\n\n  return <Text>{renderedFrame}</Text>\n})\n\nTextAnimation.displayName = 'TextAnimation'\n\nexport {TextAnimation}\n"]}