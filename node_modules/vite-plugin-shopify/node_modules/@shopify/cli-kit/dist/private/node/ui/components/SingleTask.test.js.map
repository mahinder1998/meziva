{"version":3,"file":"SingleTask.test.js","sourceRoot":"","sources":["../../../../../src/private/node/ui/components/SingleTask.test.tsx"],"names":[],"mappings":"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","sourcesContent":["import {SingleTask} from './SingleTask.js'\nimport {render} from '../../testing/ui.js'\nimport React from 'react'\nimport {describe, expect, test} from 'vitest'\n\ndescribe('SingleTask', () => {\n  test('unmounts when promise resolves successfully', async () => {\n    // Given\n    const title = 'Uploading files'\n    let resolvePromise: (value: string) => void\n    const taskPromise = new Promise<string>((resolve) => {\n      resolvePromise = resolve\n    })\n\n    // When\n    const renderInstance = render(<SingleTask title={title} taskPromise={taskPromise} />)\n\n    // Wait for initial render\n    await new Promise((resolve) => setTimeout(resolve, 10))\n\n    // Resolve the promise\n    resolvePromise!('success')\n\n    // Wait for component to update and unmount\n    await renderInstance.waitUntilExit()\n\n    // Then - component should unmount cleanly\n    expect(renderInstance.lastFrame()).toBeDefined()\n  })\n\n  test('unmounts when promise rejects', async () => {\n    // Given\n    const title = 'Failed task'\n    let rejectPromise: (error: Error) => void\n    const taskPromise = new Promise<string>((resolve, reject) => {\n      rejectPromise = reject\n    })\n\n    // When\n    const renderInstance = render(<SingleTask title={title} taskPromise={taskPromise} />)\n\n    // Wait for initial render\n    await new Promise((resolve) => setTimeout(resolve, 10))\n\n    // Reject the promise and expect waitUntilExit to reject\n    rejectPromise!(new Error('Task failed'))\n\n    // The component should exit with the error\n    await expect(renderInstance.waitUntilExit()).rejects.toThrow('Task failed')\n  })\n\n  test('handles promise that resolves immediately', async () => {\n    // Given\n    const title = 'Instant task'\n    const taskPromise = Promise.resolve('immediate success')\n\n    // When\n    const renderInstance = render(<SingleTask title={title} taskPromise={taskPromise} />)\n    await renderInstance.waitUntilExit()\n\n    // Then - component should complete successfully\n    expect(renderInstance.lastFrame()).toBeDefined()\n  })\n\n  test('handles promise that rejects immediately', async () => {\n    // Given\n    const title = 'Instant failure'\n    const taskPromise = Promise.reject(new Error('Immediate error'))\n\n    // When\n    const renderInstance = render(<SingleTask title={title} taskPromise={taskPromise} />)\n\n    // Then - should exit with error\n    await expect(renderInstance.waitUntilExit()).rejects.toThrow('Immediate error')\n  })\n\n  test('handles different types of promise return values', async () => {\n    // Test with string\n    const stringTask = Promise.resolve('task completed')\n    const stringRender = render(<SingleTask title=\"String task\" taskPromise={stringTask} />)\n    await stringRender.waitUntilExit()\n    expect(stringRender.lastFrame()).toBeDefined()\n\n    // Test with object\n    const objectTask = Promise.resolve({id: 1, name: 'test'})\n    const objectRender = render(<SingleTask title=\"Object task\" taskPromise={objectTask} />)\n    await objectRender.waitUntilExit()\n    expect(objectRender.lastFrame()).toBeDefined()\n\n    // Test with number\n    const numberTask = Promise.resolve(42)\n    const numberRender = render(<SingleTask title=\"Number task\" taskPromise={numberTask} />)\n    await numberRender.waitUntilExit()\n    expect(numberRender.lastFrame()).toBeDefined()\n\n    // Test with boolean\n    const booleanTask = Promise.resolve(true)\n    const booleanRender = render(<SingleTask title=\"Boolean task\" taskPromise={booleanTask} />)\n    await booleanRender.waitUntilExit()\n    expect(booleanRender.lastFrame()).toBeDefined()\n  })\n\n  test('handles promise with delayed resolution', async () => {\n    // Given\n    const title = 'Delayed task'\n    const taskPromise = new Promise<string>((resolve) => {\n      setTimeout(() => resolve('completed'), 100)\n    })\n\n    // When\n    const renderInstance = render(<SingleTask title={title} taskPromise={taskPromise} />)\n\n    // Wait for completion\n    await renderInstance.waitUntilExit()\n\n    // Then\n    expect(renderInstance.lastFrame()).toBeDefined()\n  })\n\n  test('handles promise with delayed rejection', async () => {\n    // Given\n    const title = 'Delayed failure'\n    const taskPromise = new Promise<string>((resolve, reject) => {\n      setTimeout(() => reject(new Error('delayed error')), 100)\n    })\n\n    // When\n    const renderInstance = render(<SingleTask title={title} taskPromise={taskPromise} />)\n\n    // Wait for completion - should throw error\n    await expect(renderInstance.waitUntilExit()).rejects.toThrow('delayed error')\n  })\n\n  test('preserves error types and messages', async () => {\n    // Test with custom error\n    class CustomError extends Error {\n      constructor(message: string, public code: string) {\n        super(message)\n        this.name = 'CustomError'\n      }\n    }\n\n    const customError = new CustomError('Custom error message', 'CUSTOM_CODE')\n    const taskPromise = Promise.reject(customError)\n\n    // When\n    const renderInstance = render(<SingleTask title=\"Custom error task\" taskPromise={taskPromise} />)\n\n    // Then - should preserve the exact error\n    await expect(renderInstance.waitUntilExit()).rejects.toThrow('Custom error message')\n  })\n\n  test('handles concurrent promise operations', async () => {\n    // Given - Multiple SingleTask components with different promises\n    const fastPromise = new Promise((resolve) => setTimeout(() => resolve('fast'), 50))\n    const slowPromise = new Promise((resolve) => setTimeout(() => resolve('slow'), 150))\n\n    // When\n    const fastRender = render(<SingleTask title=\"Fast task\" taskPromise={fastPromise} />)\n    const slowRender = render(<SingleTask title=\"Slow task\" taskPromise={slowPromise} />)\n\n    // Then - Both should complete successfully\n    await fastRender.waitUntilExit()\n    await slowRender.waitUntilExit()\n\n    expect(fastRender.lastFrame()).toBeDefined()\n    expect(slowRender.lastFrame()).toBeDefined()\n  })\n\n  test('passes noColor prop to LoadingBar component', async () => {\n    // Given\n    const title = 'No color task'\n    const taskPromise = Promise.resolve()\n\n    // When - Test that noColor prop doesn't break the component\n    const renderInstance = render(<SingleTask title={title} taskPromise={taskPromise} noColor />)\n    await renderInstance.waitUntilExit()\n\n    // Then - Component should complete successfully with noColor prop\n    expect(renderInstance.lastFrame()).toBeDefined()\n  })\n})\n"]}