class n extends HTMLElement{constructor(){super(),this.sliderWrapper=this.querySelector('[data-role="slider-wrapper"]'),this.thumbWrapper=this.querySelector('[data-role="thumb-wrapper"]'),this.sliderThumb=this.querySelector('[data-role="thumb"]'),this.desktopCards=parseInt(this.dataset.desktopCards)||3,this.mobilePerView=parseFloat(this.dataset.mobilePerview)||1.2,this.slides=[],this.slider=null,this.keenInstance=null}connectedCallback(){window.KeenSlider?this.initializeSlider(window.KeenSlider):document.addEventListener("custom:KeenLoaded",()=>{window.KeenSlider&&this.initializeSlider(window.KeenSlider)})}initializeSlider(t){if(!this.sliderWrapper)return;this.slides=Array.from(this.sliderWrapper.querySelectorAll(".keen-slider__slide"));const i=this.mobilePerView,e=Math.max(1,this.desktopCards),l=16,s=32;this.keenInstance=new t(this.sliderWrapper,{loop:!1,rubberband:!1,mode:"free",drag:!0,slides:{perView:i,spacing:l,origin:"auto"},breakpoints:{"(min-width: 768px)":{slides:{perView:e,spacing:s,origin:"auto",rubberband:!1,mode:"free",drag:!0}}}},[r=>{r.on("created",()=>{this.slider=r,this.setupArrows(),this.wheelControls(r),this.setupThumbSync(r),this.attachVideoControls(),this.updateThumb(),r.on("slideChanged",()=>this.pauseAllVideos())})}])}setupArrows(){const t=this.querySelector('[data-role="arrow-prev"]'),i=this.querySelector('[data-role="arrow-next"]'),e=this.slides.length,l=window.innerWidth>=768?Math.max(1,this.desktopCards):this.mobilePerView,s=e>l;t&&(t.style.display=s?"":"none"),i&&(i.style.display=s?"":"none"),s&&(t&&t.addEventListener("click",()=>this.slider.prev()),i&&i.addEventListener("click",()=>this.slider.next()))}wheelControls(t){let i,e=!1;function l(s){if(Math.abs(s.deltaY)>Math.abs(s.deltaX))return;s.preventDefault();const r=s.deltaY||s.deltaX;e||(t.track.stopped=!1,t.track.animating=!1,e=!0),t.track.addMovement(-r),clearTimeout(i),i=setTimeout(()=>{e=!1},80)}t.on("created",()=>{t.container.addEventListener("wheel",l,{passive:!1})})}setupThumbSync(t){if(!this.thumbWrapper||!this.sliderThumb)return;const i=()=>this.updateThumb();t.on("detailsChanged",i),window.addEventListener("resize",i),new MutationObserver(i).observe(this.sliderWrapper,{childList:!0,subtree:!0})}updateThumb(){if(!this.slider||!this.sliderThumb||!this.thumbWrapper)return;const t=this.slider.track.details.slides.length||this.slides.length||1,i=window.innerWidth>=768?Math.max(1,this.desktopCards):this.mobilePerView;if(t<=i){this.thumbWrapper.style.display="none";return}else this.thumbWrapper.style.display="";const e=this.thumbWrapper.offsetWidth||1,s=Math.min(100,i/t*100)/100*e,r=Math.max(0,Math.min(1,this.slider.track.details.progress||0)),a=Math.max(0,e-s),o=r*a;this.sliderThumb.style.width=`${Math.round(s)}px`,this.sliderThumb.style.left=`${Math.round(o)}px`}attachVideoControls(){const t=Array.from(this.querySelectorAll("video"));t.forEach(e=>{const l=e.dataset.videoSrc;l&&!e.querySelector("source")&&(e.src=l,e.preload="metadata",e.controls=!1,e.pause())}),Array.from(this.querySelectorAll(".fc-video-play")).forEach(e=>{e.addEventListener("click",l=>{l.preventDefault();const s=e.closest(".keen-slider__slide");if(!s)return;const r=s.querySelector("video");r&&(this.pauseAllVideos(r),r.paused?(r.play().catch(()=>{}),r.controls=!0,e.style.display="none",r.addEventListener("ended",()=>{e.style.display="",r.controls=!1},{once:!0})):(r.pause(),r.controls=!1,e.style.display=""))})}),t.forEach(e=>{e.addEventListener("play",()=>this.pauseAllVideos(e)),e.addEventListener("pause",()=>{const l=e.closest(".keen-slider__slide");if(!l)return;const s=l.querySelector(".fc-video-play");s&&(s.style.display="")})})}pauseAllVideos(t=null){Array.from(this.querySelectorAll("video")).forEach(e=>{if(t&&e===t)return;try{e.pause(),e.controls=!1}catch{}const l=e.closest(".keen-slider__slide");if(l){const s=l.querySelector(".fc-video-play");s&&(s.style.display="")}})}disconnectedCallback(){var t,i;try{(t=this.keenInstance)!=null&&t.destroy?this.keenInstance.destroy():(i=this.slider)!=null&&i.destroy&&this.slider.destroy()}catch{}window.removeEventListener("resize",this.updateThumb)}}customElements.define("featured-slider",n);
