{% liquid
    assign sales = settings.sale_layout
    assign bg_type = section.settings.background_type
    assign bg_image = section.settings.bg_image
    assign bg_color = section.settings.background_color
    assign text_color = section.settings.text_color
    if sales
        assign block_type = 'sale-announcement'
    else
        assign block_type = 'announcement'
    endif
    assign blocks_to_render = 0
    for block in section.blocks
        if block.type == block_type
            assign blocks_to_render = blocks_to_render | plus : 1
        endif
    endfor
%}
{% if blocks_to_render > 0 %}
    <section id="announcement-bar={{ section.id }}">
        <announcement-bar class="mb-relative" data-section="{{ section.id }}"
            data-autoplay="{{ section.settings.autoplay }}"
            data-time="{{ section.settings.autoplay_time }}"
            data-blocks="{{ blocks_to_render }}"
        >
            <div style="{% if bg_type == 'image' %}background-image:url('{{ bg_image | image_url : 400 }}'){% else %}background-color:{{  bg_color }}{% endif %}" data-role="container" class="mb-flex mb-flex-nowrap {% if blocks_to_render > 1 %}keen-slider{% endif %}">
                {% for block in section.blocks %}
                    {% if block.type == block_type %}
                        {% liquid
                        assign behavior = block.settings.behavior
                        assign text = block.settings.announcement_text
                        assign link = block.settings.announcement_link
                        assign copy_text = block.settings.copy_text_content
                        assign copy_icon = block.settings.copy_icon
                        %}
                        <div class="mb-flex-[0_0_100%] mb-max-w-[100%] mb-flex mb-justify-center mb-items-center mb-px-3 mb-py-3 mb-group {% if blocks_to_render > 1 %}keen-slider__slide{% endif %}" data-beahavior="{{ behavior }}" data-role="announcement-strip" data-content="{{ copy_text }}" data-text="{{ text }}">
                            {% if behavior == 'redirect' %}
                                <a href="{{ link }}" style="color:{{ text_color }};" class="mb-no-underline mb-text-[14px] xl:mb-text-[16px] mb-text-center mb-leading-[18px] *:mb-mb-0 mb-font-body mb-font-normal">{{ text }}</a>
                            {% else %}
                                <div data-role="copy" style="color:{{ text_color }};" class="mb-flex mb-items-center mb-gap-[4px] mb-cursor-pointer *:mb-mb-0"><span class="mb-opacity mb-no-underline mb-font-body mb-text-[13px] xl:mb-text-[14px] mb-font-medium *:mb-mb-0 mb-text-center mb-leading-[18px]">
                                    {{ text }}
                                    </span>
                                    {% if copy_icon %}
                                        <span class="mb-relative mb-w-[20px] mb-h-[20px] mb-flex mb-justify-center mb-items-center">
                                            {% render 'icons-v2', icon:'icon-copy',class:'mb-w-[14px] mb-h-[14px] mb-transition-all group-[&.copied]:mb-opacity-0' %}
                                            {% render 'icons-v2',icon:'icon-copy-check', class:'mb-w-[14px] mb-h-[14px] mb-absolute mb-opacity-0 group-[&.copied]:mb-opacity-100 mb-top-[50%] mb-left-[50%] mb-translate-x-[-50%] mb-translate-y-[-50%]' %}
                                        </span>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            {% if section.settings.arrows and blocks_to_render > 1 %}
                <button class="mb-absolute mb-top-[50%] mb-translate-y-[-50%] mb-left-[10px] mb-z-[1] mb-w-[20px] mb-h-[20px] mb-flex mb-justify-center mb-items-center" data-role="prev" style="color:{{ text_color }}">{% render 'icons-v2', icon:'icon-caret-left',class:'mb-w-4 mb-h-4' %}</button>
                <button class="mb-absolute mb-top-[50%] mb-translate-y-[-50%] mb-right-[10px] mb-z-[1] mb-w-[20px] mb-h-[20px] mb-flex jmb-ustify-center mb-items-center" data-role="next"  style="color:{{ text_color }}">{% render 'icons-v2', icon:'icon-caret-right',class:'mb-w-4 mb-h-4' %}</button>
            {% endif %}
        </announcement-bar>
    </section>
{% endif %}
{% if blocks_to_render > 1 %}
    {% render 'vite-tag' with 'announcement-bar-v2.js' %}
{% endif %}
{% schema %}
    {
        "name":"Announcement Bar",
        "settings":[
            {
                "type":"select",
                "label":"Background Type",
                "id":"background_type",
                "options": [
                    {
                        "value":"image",
                        "label":"Image"
                    },
                    {
                        "value":"color",
                        "label":"Color"
                    }
                ],
                "default":"color"
            },
            {
                "type":"image_picker",
                "label":"Choose Background Image",
                "id":"bg_image"
            },
            {
                "type":"color",
                "label":"Background Color",
                "id":"background_color",
                "default":"#FF60A6"
            },
            {
                "type":"color",
                "label":"Text Color",
                "id":"text_color",
                "default":"#ffffff"
            },
            {
                "type":"checkbox",
                "label":"Display Arrows",
                "id":"arrows"
            },
            {
                "type":"checkbox",
                "label":"Enable autoplay",
                "id":"autoplay"
            },
            {
                "type":"number",
                "label":"Autoplay time in seconds",
                "id":"autoplay_time",
                "default":3
            }
        ],
        "blocks":[
            {
                "type":"announcement",
                "name":"Announcement",
                "settings":[
                    {
                        "type":"richtext",
                        "label":"Announcement Bar Text",
                        "id":"announcement_text"
                    },
                    {
                        "type":"text",
                        "label":"Announcement Bar Link",
                        "id":"announcement_link"
                    },
                    {
                        "type":"select",
                        "label":"Link Behavior",
                        "id":"behavior",
                        "default":"redirect",
                        "options":[
                            {
                                "value":"redirect",
                                "label":"Redirection"
                            },
                            {
                                "value":"copy",
                                "label":"Copy Code"
                            }
                        ]
                    },
                    {
                        "type":"checkbox",
                        "label":"Display copy icon",
                        "id":"copy_icon",
                        "info":"If behavior is selected to be Copy Code"
                    },
                    {
                        "type":"text",
                        "label":"Copy text content",
                        "id":"copy_text_content",
                        "info":"If Bhevaior set to Copy code then the copied code will be needed to enter here"
                    }
                ]
            },
            {
                "type":"sale-announcement",
                "name":"Sale Announcement",
                "settings":[
                    {
                        "type":"richtext",
                        "label":"Announcement Bar Text",
                        "id":"announcement_text"
                    },
                    {
                        "type":"text",
                        "label":"Announcement Bar Link",
                        "id":"announcement_link"
                    },
                    {
                        "type":"select",
                        "label":"Link Behavior",
                        "id":"behavior",
                        "default":"redirect",
                        "options":[
                            {
                                "value":"redirect",
                                "label":"Redirection"
                            },
                            {
                                "value":"copy",
                                "label":"Copy Code"
                            }
                        ]
                    },
                    {
                        "type":"text",
                        "label":"Copy text content",
                        "id":"copy_text_content",
                        "info":"If Bhevaior set to Copy code then the copied code will be needed to enter here"
                    }
                ]
            }
        ]
    }
{% endschema %}