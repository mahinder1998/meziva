{"version":3,"file":"multiple-installation-warning.js","sourceRoot":"","sources":["../../../src/public/node/multiple-installation-warning.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,iBAAiB,EAAC,MAAM,kBAAkB,CAAA;AAClD,OAAO,EAAC,sBAAsB,EAAC,MAAM,gBAAgB,CAAA;AACrD,OAAO,EAAC,UAAU,EAAC,MAAM,SAAS,CAAA;AAClC,OAAO,EAAC,gBAAgB,EAAE,eAAe,EAAC,MAAM,cAAc,CAAA;AAC9D,OAAO,EAAC,eAAe,EAAC,MAAM,sBAAsB,CAAA;AACpD,OAAO,EAAC,oBAAoB,EAAC,MAAM,kCAAkC,CAAA;AAErE;;;;;;GAMG;AACH,MAAM,CAAC,KAAK,UAAU,8BAA8B,CAClD,SAAiB,EACjB,YAAqC;IAErC,qCAAqC;IACrC,MAAM,oBAAoB,CAAC,2BAA2B,EAAE,EAAC,IAAI,EAAE,CAAC,EAAC,EAAE,KAAK,IAAI,EAAE;QAC5E,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,IAAI,iBAAiB,EAAE;YAAE,OAAM;QAEhE,MAAM,QAAQ,GAAG,sBAAsB,EAAE,CAAA;QAEzC,2FAA2F;QAC3F,gDAAgD;QAChD,MAAM,aAAa,GAAG,QAAQ,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,MAAM,gBAAgB,EAAE,CAAA;QAC3E,IAAI,CAAC,aAAa;YAAE,OAAM;QAE1B,gGAAgG;QAChG,+CAA+C;QAC/C,MAAM,YAAY,GAAG,QAAQ,CAAC,CAAC,CAAC,MAAM,eAAe,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,eAAe,CAAA;QAClF,IAAI,CAAC,YAAY;YAAE,OAAM;QAEzB,MAAM,mBAAmB,GAAG,QAAQ,CAAC,CAAC,CAAC,qBAAqB,CAAC,CAAC,CAAC,kBAAkB,CAAA;QAEjF,MAAM,cAAc,GAAG;YACrB,QAAQ,EAAE,+CAA+C,mBAAmB,EAAE;YAC9E,IAAI,EAAE;gBACJ,2BAA2B,aAAa,8BAA8B,YAAY;6JACmE;aACtJ;YACD,IAAI,EAAE;gBACJ,KAAK,EAAE,gCAAgC;gBACvC,GAAG,EAAE,oGAAoG;aAC1G;SACF,CAAA;QACD,UAAU,CAAC,cAAc,CAAC,CAAA;IAC5B,CAAC,CAAC,CAAA;AACJ,CAAC","sourcesContent":["import {jsonOutputEnabled} from './environment.js'\nimport {currentProcessIsGlobal} from './is-global.js'\nimport {renderInfo} from './ui.js'\nimport {globalCLIVersion, localCLIVersion} from './version.js'\nimport {CLI_KIT_VERSION} from '../common/version.js'\nimport {runAtMinimumInterval} from '../../private/node/conf-store.js'\n\n/**\n * Shows a warning if there are two Shopify CLI installations found (global and local).\n * Won't show anything if the user included the --json flag.\n *\n * @param directory - The directory of the project.\n * @param dependencies - The dependencies of the project.\n */\nexport async function showMultipleCLIWarningIfNeeded(\n  directory: string,\n  dependencies: {[key: string]: string},\n): Promise<void> {\n  // Show the warning only once per day\n  await runAtMinimumInterval('warn-on-multiple-versions', {days: 1}, async () => {\n    if (!dependencies['@shopify/cli'] || jsonOutputEnabled()) return\n\n    const isGlobal = currentProcessIsGlobal()\n\n    // If running globally, use the current CLI version, otherwise fetch the global CLI version\n    // Exit early if we can't get the global version\n    const globalVersion = isGlobal ? CLI_KIT_VERSION : await globalCLIVersion()\n    if (!globalVersion) return\n\n    // If running globally, fetch the local version from npm list, otherwise use current CLI version\n    // Exit early if we can't get the local version\n    const localVersion = isGlobal ? await localCLIVersion(directory) : CLI_KIT_VERSION\n    if (!localVersion) return\n\n    const currentInstallation = isGlobal ? 'global installation' : 'local dependency'\n\n    const warningContent = {\n      headline: `Two Shopify CLI installations found â€“ using ${currentInstallation}`,\n      body: [\n        `A global installation (v${globalVersion}) and a local dependency (v${localVersion}) were detected.\nWe recommend removing the @shopify/cli and @shopify/app dependencies from your package.json, unless you want to use different versions across multiple apps.`,\n      ],\n      link: {\n        label: 'See Shopify CLI documentation.',\n        url: 'https://shopify.dev/docs/apps/build/cli-for-apps#switch-to-a-global-executable-or-local-dependency',\n      },\n    }\n    renderInfo(warningContent)\n  })\n}\n"]}